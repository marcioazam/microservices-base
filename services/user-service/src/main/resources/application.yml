server:
  port: ${SERVER_PORT:8080}
  shutdown: graceful

spring:
  application:
    name: user-service
  threads:
    virtual:
      enabled: true
  lifecycle:
    timeout-per-shutdown-phase: ${SHUTDOWN_TIMEOUT:30s}
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/user_service}
    username: ${DATABASE_USERNAME:postgres}
    password: ${DATABASE_PASSWORD:postgres}
    hikari:
      maximum-pool-size: ${HIKARI_MAX_POOL_SIZE:50}
      minimum-idle: ${HIKARI_MIN_IDLE:10}
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
  flyway:
    enabled: true
    locations: classpath:db/migration
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all
      retries: 3
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${JWT_ISSUER_URI:https://auth.example.com}
          jwk-set-uri: ${JWT_JWKS_URI:https://auth.example.com/.well-known/jwks.json}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}

app:
  grpc:
    port: ${GRPC_PORT:50056}
  email-token:
    ttl-minutes: ${EMAIL_TOKEN_TTL_MINUTES:60}
  argon2:
    memory-kb: ${ARGON2_MEMORY_KB:65536}
    iterations: ${ARGON2_ITERATIONS:3}
    parallelism: ${ARGON2_PARALLELISM:1}
  rate-limit:
    registration:
      per-minute: ${RATE_LIMIT_REGISTRATION_PER_MINUTE:5}
    resend:
      per-hour: ${RATE_LIMIT_RESEND_PER_HOUR:3}
    verify:
      per-minute: ${RATE_LIMIT_VERIFY_PER_MINUTE:10}
  platform:
    crypto-service:
      url: ${CRYPTO_SERVICE_URL:localhost:50051}
      timeout-ms: ${CRYPTO_SERVICE_TIMEOUT_MS:5000}
    cache-service:
      url: ${CACHE_SERVICE_URL:localhost:50060}
      timeout-ms: ${CACHE_SERVICE_TIMEOUT_MS:5000}
    logging-service:
      url: ${LOGGING_SERVICE_URL:localhost:50061}
      timeout-ms: ${LOGGING_SERVICE_TIMEOUT_MS:5000}

logging:
  level:
    root: INFO
    com.authplatform.usersvc: DEBUG
  pattern:
    console: '{"timestamp":"%d{ISO8601}","level":"%level","logger":"%logger","correlationId":"%X{correlationId}","userId":"%X{userId}","message":"%msg"}%n'

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
