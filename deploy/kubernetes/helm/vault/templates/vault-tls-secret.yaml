{{- if .Values.vault.enabled }}
# TLS Certificate for Vault Server
# This should be replaced with cert-manager Certificate in production
apiVersion: v1
kind: Secret
metadata:
  name: vault-tls
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "vault-config.labels" . | nindent 4 }}
type: kubernetes.io/tls
data:
  # Placeholder - replace with actual certificates
  # In production, use cert-manager to generate these
  tls.crt: ""
  tls.key: ""
  ca.crt: ""
---
# cert-manager Certificate for Vault TLS
{{- if .Values.certManager.enabled }}
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: vault-server-tls
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "vault-config.labels" . | nindent 4 }}
spec:
  secretName: vault-tls
  duration: 8760h  # 1 year
  renewBefore: 720h  # 30 days
  subject:
    organizations:
      - Auth Platform
  commonName: vault.{{ .Release.Namespace }}.svc
  isCA: false
  privateKey:
    algorithm: ECDSA
    size: 256
  usages:
    - server auth
    - client auth
  dnsNames:
    - vault
    - vault.{{ .Release.Namespace }}
    - vault.{{ .Release.Namespace }}.svc
    - vault.{{ .Release.Namespace }}.svc.cluster.local
    - vault-0.vault-internal
    - vault-1.vault-internal
    - vault-2.vault-internal
    - vault-0.vault-internal.{{ .Release.Namespace }}.svc
    - vault-1.vault-internal.{{ .Release.Namespace }}.svc
    - vault-2.vault-internal.{{ .Release.Namespace }}.svc
  ipAddresses:
    - 127.0.0.1
  issuerRef:
    name: {{ .Values.certManager.issuerName | default "vault-ca-issuer" }}
    kind: {{ .Values.certManager.issuerKind | default "ClusterIssuer" }}
{{- end }}
{{- end }}
